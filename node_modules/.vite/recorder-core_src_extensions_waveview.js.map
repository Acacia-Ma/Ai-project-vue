{
  "version": 3,
  "sources": ["../recorder-core/src/extensions/waveview.js", "dep:recorder-core_src_extensions_waveview"],
  "sourcesContent": ["/*\r\n\u5F55\u97F3 Recorder\u6269\u5C55\uFF0C\u52A8\u6001\u6CE2\u5F62\u663E\u793A\r\nhttps://github.com/xiangyuecn/Recorder\r\n*/\r\n(function(factory){\r\n\tvar browser=typeof window==\"object\" && !!window.document;\r\n\tvar win=browser?window:Object; //\u975E\u6D4F\u89C8\u5668\u73AF\u5883\uFF0CRecorder\u6302\u8F7D\u5728Object\u4E0B\u9762\r\n\tvar rec=win.Recorder,ni=rec.i18n;\r\n\tfactory(rec,ni,ni.$T,browser);\r\n}(function(Recorder,i18n,$T,isBrowser){\r\n\"use strict\";\r\n\r\nvar WaveView=function(set){\r\n\treturn new fn(set);\r\n};\r\nvar ViewTxt=\"WaveView\";\r\nvar fn=function(set){\r\n\tvar This=this;\r\n\tvar o={\r\n\t\t/*\r\n\t\telem:\"css selector\" //\u81EA\u52A8\u663E\u793A\u5230dom\uFF0C\u5E76\u4EE5\u6B64dom\u5927\u5C0F\u4E3A\u663E\u793A\u5927\u5C0F\r\n\t\t\t//\u6216\u8005\u914D\u7F6E\u663E\u793A\u5927\u5C0F\uFF0C\u624B\u52A8\u628AwaveviewObj.elem\u663E\u793A\u5230\u522B\u7684\u5730\u65B9\r\n\t\t,width:0 //\u663E\u793A\u5BBD\u5EA6\r\n\t\t,height:0 //\u663E\u793A\u9AD8\u5EA6\r\n\t\t\r\nH5\u73AF\u5883\u4EE5\u4E0A\u914D\u7F6E\u4E8C\u9009\u4E00\r\n\t\t\r\n\t\tcompatibleCanvas: CanvasObject //\u63D0\u4F9B\u4E00\u4E2A\u517C\u5BB9H5\u7684canvas\u5BF9\u8C61\uFF0C\u9700\u652F\u6301getContext(\"2d\")\uFF0C\u652F\u6301\u8BBE\u7F6Ewidth\u3001height\uFF0C\u652F\u6301drawImage(canvas,...)\r\n\t\t,width:0 //canvas\u663E\u793A\u5BBD\u5EA6\r\n\t\t,height:0 //canvas\u663E\u793A\u9AD8\u5EA6\r\n\u975EH5\u73AF\u5883\u4F7F\u7528\u4EE5\u4E0A\u914D\u7F6E\r\n\t\t*/\r\n\t\t\r\n\t\tscale:2 //\u7F29\u653E\u7CFB\u6570\uFF0C\u5E94\u4E3A\u6B63\u6574\u6570\uFF0C\u4F7F\u75282(3? no!)\u500D\u5BBD\u9AD8\u8FDB\u884C\u7ED8\u5236\uFF0C\u907F\u514D\u79FB\u52A8\u7AEF\u7ED8\u5236\u6A21\u7CCA\r\n\t\t,speed:9 //\u79FB\u52A8\u901F\u5EA6\u7CFB\u6570\uFF0C\u8D8A\u5927\u8D8A\u5FEB\r\n\t\t,phase:21.8 //\u76F8\u4F4D\uFF0C\u8C03\u6574\u4E86\u901F\u5EA6\u540E\uFF0C\u8C03\u6574\u8FD9\u4E2A\u503C\u5F97\u5230\u4E00\u4E2A\u770B\u8D77\u6765\u8212\u670D\u7684\u6CE2\u5F62\r\n\t\t\r\n\t\t,fps:20 //\u7ED8\u5236\u5E27\u7387\uFF0C\u8C03\u6574\u540E\u4E5F\u9700\u8C03\u6574phase\u503C\r\n\t\t,keep:true //\u5F53\u505C\u6B62\u4E86input\u8F93\u5165\u65F6\uFF0C\u662F\u5426\u4FDD\u6301\u6CE2\u5F62\uFF0C\u8BBE\u4E3Afalse\u505C\u6B62\u540E\u5C06\u53D8\u6210\u4E00\u6761\u7EBF\r\n\t\t\r\n\t\t,lineWidth:3 //\u7EBF\u6761\u57FA\u7840\u7C97\u7EC6\r\n\t\t\r\n\t\t//\u6E10\u53D8\u8272\u914D\u7F6E\uFF1A[\u4F4D\u7F6E\uFF0Ccss\u989C\u8272\uFF0C...] \u4F4D\u7F6E: \u53D6\u503C0.0-1.0\u4E4B\u95F4\r\n\t\t,linear1:[0,\"rgba(150,96,238,1)\",0.2,\"rgba(170,79,249,1)\",1,\"rgba(53,199,253,1)\"] //\u7EBF\u6761\u6E10\u53D8\u82721\uFF0C\u4ECE\u5DE6\u5230\u53F3\r\n\t\t,linear2:[0,\"rgba(209,130,255,0.6)\",1,\"rgba(53,199,255,0.6)\"] //\u7EBF\u6761\u6E10\u53D8\u82722\uFF0C\u4ECE\u5DE6\u5230\u53F3\r\n\t\t,linearBg:[0,\"rgba(255,255,255,0.2)\",1,\"rgba(54,197,252,0.2)\"] //\u80CC\u666F\u6E10\u53D8\u8272\uFF0C\u4ECE\u4E0A\u5230\u4E0B\r\n\t};\r\n\tfor(var k in set){\r\n\t\to[k]=set[k];\r\n\t};\r\n\tThis.set=set=o;\r\n\t\r\n\tvar cCanvas=\"compatibleCanvas\";\r\n\tif(set[cCanvas]){\r\n\t\tvar canvas=This.canvas=set[cCanvas];\r\n\t}else{\r\n\t\tif(!isBrowser)throw new Error($T.G(\"NonBrowser-1\",[ViewTxt]));\r\n\t\tvar elem=set.elem;\r\n\t\tif(elem){\r\n\t\t\tif(typeof(elem)==\"string\"){\r\n\t\t\t\telem=document.querySelector(elem);\r\n\t\t\t}else if(elem.length){\r\n\t\t\t\telem=elem[0];\r\n\t\t\t};\r\n\t\t};\r\n\t\tif(elem){\r\n\t\t\tset.width=elem.offsetWidth;\r\n\t\t\tset.height=elem.offsetHeight;\r\n\t\t};\r\n\t\t\r\n\t\tvar thisElem=This.elem=document.createElement(\"div\");\r\n\t\tthisElem.style.fontSize=0;\r\n\t\tthisElem.innerHTML='<canvas style=\"width:100%;height:100%;\"/>';\r\n\t\t\r\n\t\tvar canvas=This.canvas=thisElem.querySelector(\"canvas\");\r\n\t\t\r\n\t\tif(elem){\r\n\t\t\telem.innerHTML=\"\";\r\n\t\t\telem.appendChild(thisElem);\r\n\t\t};\r\n\t};\r\n\tvar scale=set.scale;\r\n\tvar width=set.width*scale;\r\n\tvar height=set.height*scale;\r\n\tif(!width || !height){\r\n\t\tthrow new Error($T.G(\"IllegalArgs-1\",[ViewTxt+\" width=0 height=0\"]));\r\n\t};\r\n\t\r\n\tcanvas.width=width;\r\n\tcanvas.height=height;\r\n\tvar ctx=This.ctx=canvas.getContext(\"2d\");\r\n\t\r\n\tThis.linear1=This.genLinear(ctx,width,set.linear1);\r\n\tThis.linear2=This.genLinear(ctx,width,set.linear2);\r\n\tThis.linearBg=This.genLinear(ctx,height,set.linearBg,true);\r\n\t\r\n\tThis._phase=0;\r\n};\r\nfn.prototype=WaveView.prototype={\r\n\tgenLinear:function(ctx,size,colors,top){\r\n\t\tvar rtv=ctx.createLinearGradient(0,0,top?0:size,top?size:0);\r\n\t\tfor(var i=0;i<colors.length;){\r\n\t\t\trtv.addColorStop(colors[i++],colors[i++]);\r\n\t\t};\r\n\t\treturn rtv;\r\n\t}\r\n\t,genPath:function(frequency,amplitude,phase){\r\n\t\t//\u66F2\u7EBF\u751F\u6210\u7B97\u6CD5\u53C2\u8003 https://github.com/HaloMartin/MCVoiceWave/blob/f6dc28975fbe0f7fc6cc4dbc2e61b0aa5574e9bc/MCVoiceWave/MCVoiceWaveView.m#L268\r\n\t\tvar rtv=[];\r\n\t\tvar This=this,set=This.set;\r\n\t\tvar scale=set.scale;\r\n\t\tvar width=set.width*scale;\r\n\t\tvar maxAmplitude=set.height*scale/2;\r\n\t\t\r\n\t\tfor(var x=0;x<=width;x+=scale) {\r\n\t\t\tvar scaling=(1+Math.cos(Math.PI+(x/width)*2*Math.PI))/2;\r\n\t\t\tvar y=scaling*maxAmplitude*amplitude*Math.sin(2*Math.PI*(x/width)*frequency+phase)+maxAmplitude;\r\n\t\t\trtv.push(y);\r\n\t\t}\r\n\t\treturn rtv;\r\n\t}\r\n\t,input:function(pcmData,powerLevel,sampleRate){\r\n\t\tvar This=this;\r\n\t\tThis.sampleRate=sampleRate;\r\n\t\tThis.pcmData=pcmData;\r\n\t\tThis.pcmPos=0;\r\n\t\t\r\n\t\tThis.inputTime=Date.now();\r\n\t\tThis.schedule();\r\n\t}\r\n\t,schedule:function(){\r\n\t\tvar This=this,set=This.set;\r\n\t\tvar interval=Math.floor(1000/set.fps);\r\n\t\tif(!This.timer){\r\n\t\t\tThis.timer=setInterval(function(){\r\n\t\t\t\tThis.schedule();\r\n\t\t\t},interval);\r\n\t\t};\r\n\t\t\r\n\t\tvar now=Date.now();\r\n\t\tvar drawTime=This.drawTime||0;\r\n\t\tif(now-drawTime<interval){\r\n\t\t\t//\u6CA1\u5230\u95F4\u9694\u65F6\u95F4\uFF0C\u4E0D\u7ED8\u5236\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tThis.drawTime=now;\r\n\t\t\r\n\t\t//\u5207\u5206\u5F53\u524D\u9700\u8981\u7684\u7ED8\u5236\u6570\u636E\r\n\t\tvar bufferSize=This.sampleRate/set.fps;\r\n\t\tvar pcm=This.pcmData;\r\n\t\tvar pos=This.pcmPos;\r\n\t\tvar len=Math.max(0, Math.min(bufferSize,pcm.length-pos));\r\n\t\tvar sum=0;\r\n\t\tfor(var i=0;i<len;i++,pos++){\r\n\t\t\tsum+=Math.abs(pcm[pos]);\r\n\t\t};\r\n\t\tThis.pcmPos=pos;\r\n\t\t\r\n\t\t//\u63A8\u5165\u7ED8\u5236\r\n\t\tif(len || !set.keep){\r\n\t\t\tThis.draw(Recorder.PowerLevel(sum, len));\r\n\t\t}\r\n\t\tif(!len && now-This.inputTime>1300){\r\n\t\t\t//\u8D85\u65F6\u6CA1\u6709\u8F93\u5165\uFF0C\u5E72\u6389\u5B9A\u65F6\u5668\r\n\t\t\tclearInterval(This.timer);\r\n\t\t\tThis.timer=0;\r\n\t\t}\r\n\t}\r\n\t,draw:function(powerLevel){\r\n\t\tvar This=this,set=This.set;\r\n\t\tvar ctx=This.ctx;\r\n\t\tvar scale=set.scale;\r\n\t\tvar width=set.width*scale;\r\n\t\tvar height=set.height*scale;\r\n\t\t\r\n\t\tvar speedx=set.speed/set.fps;\r\n\t\tvar phase=This._phase-=speedx;//\u4F4D\u79FB\u901F\u5EA6\r\n\t\tvar phase2=phase+speedx*set.phase;\r\n\t\tvar amplitude=powerLevel/100;\r\n\t\tvar path1=This.genPath(2,amplitude,phase);\r\n\t\tvar path2=This.genPath(1.8,amplitude,phase2);\r\n\t\t\r\n\t\t//\u5F00\u59CB\u7ED8\u5236\u56FE\u5F62\r\n\t\tctx.clearRect(0,0,width,height);\r\n\t\t\r\n\t\t//\u7ED8\u5236\u5305\u56F4\u80CC\u666F\r\n\t\tctx.beginPath();\r\n\t\tfor(var i=0,x=0;x<=width;i++,x+=scale) {\r\n\t\t\tif (x==0) {\r\n\t\t\t\tctx.moveTo(x,path1[i]);\r\n\t\t\t}else {\r\n\t\t\t\tctx.lineTo(x,path1[i]);\r\n\t\t\t};\r\n\t\t};\r\n\t\ti--;\r\n\t\tfor(var x=width-1;x>=0;i--,x-=scale) {\r\n\t\t\tctx.lineTo(x,path2[i]);\r\n\t\t};\r\n\t\tctx.closePath();\r\n\t\tctx.fillStyle=This.linearBg;\r\n\t\tctx.fill();\r\n\t\t\r\n\t\t//\u7ED8\u5236\u7EBF\r\n\t\tThis.drawPath(path2,This.linear2);\r\n\t\tThis.drawPath(path1,This.linear1);\r\n\t}\r\n\t,drawPath:function(path,linear){\r\n\t\tvar This=this,set=This.set;\r\n\t\tvar ctx=This.ctx;\r\n\t\tvar scale=set.scale;\r\n\t\tvar width=set.width*scale;\r\n\t\t\r\n\t\tctx.beginPath();\r\n\t\tfor(var i=0,x=0;x<=width;i++,x+=scale) {\r\n\t\t\tif (x==0) {\r\n\t\t\t\tctx.moveTo(x,path[i]);\r\n\t\t\t}else {\r\n\t\t\t\tctx.lineTo(x,path[i]);\r\n\t\t\t};\r\n\t\t};\r\n\t\tctx.lineWidth=set.lineWidth*scale;\r\n\t\tctx.strokeStyle=linear;\r\n\t\tctx.stroke();\r\n\t}\r\n};\r\nRecorder[ViewTxt]=WaveView;\r\n\r\n\t\r\n}));", "export default require(\"./node_modules/recorder-core/src/extensions/waveview.js\");"],
  "mappings": "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",
  "names": []
}
