import{a as e}from"./axios.a42fa0ce.js";import{d as t}from"./pinia.11340e00.js";import{b as s,e as r}from"./element-plus.e5f0d4bb.js";const o=t("user",{state:()=>({username:"",password:"",access_token:"",refresh_token:"",now_time:0}),persist:!0,getters:{},actions:{Savingtoken(e){return new Promise(((t,s)=>{this.access_token=e.access_token,this.refresh_token=e.refresh_token,this.username=e.username,this.now_time=(new Date).getTime(),t()}))},refresh_token(e){return new Promise(((t,s)=>{this.access_token=e.access_token,this.now_time=(new Date).getTime(),t()}))},Logout(){return new Promise(((e,t)=>{this.access_token="",this.refresh_token="",this.now_time=0,e()}))}}}),n=t("util",{state:()=>({base_url:"http://localhost:5000",post_url:"http://localhost:5000"}),persist:!0});let a=e.create({timeout:25e3,baseURL:n().post_url});a.interceptors.request.use((function(e){return"/uploadimg/"==e.url?e.headers["Content-Type"]="multipart/form-data;charset=UTF-8":e.headers["Content-Type"]="application/json;charset=UTF-8","/refreshtoken/"==e.url?e.headers.Authorization="Bearer "+o().refresh_token:e.headers.Authorization="Bearer "+o().access_token,e}),(function(e){return Promise.reject(e)})),a.interceptors.response.use((function(e){let t=e.data;return 0!==t.code?(function(e){let t=e.msg+"!";-1==e.code&&(t="服务器错误！");r.alert(t,"提示",{confirmButtonText:"确定",type:"warning"}).then((()=>{}))}(t),Promise.reject(t)):Promise.resolve(t)}),(function(e){if(e&&e.response)switch(e.response.status){case 400:break;case 401:s.error("未授权，请重新登录"),setTimeout((()=>{window.location="/login"}),1e3)}return Promise.reject(e)}));export{n as a,a as s,o as u};
